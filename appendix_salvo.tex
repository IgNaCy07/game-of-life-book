%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%   CHAPTER: UNIVERSALITY OF THE CLOCK INSERTER
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% http://conwaylife.com/forums/viewtopic.php?f=2&t=299
%% http://conwaylife.com/forums/viewtopic.php?f=2&t=1512&start=50
\renewcommand{\chapterfolder}{glider_synthesis/}
\chapter{Universality of the Clock Inserter}\label{chp:appendix_salvo}

In Section~\ref{sec:slow_salvo}, we showed that we can use a p1 slow salvo to simulate any glider synthesis in which the gliders are not ``too close'' together, and we suggested that the clock inserter\index{clock!inserter} from Figure~\ref{fig:clock_inserter} could be used to remove that final spacing restriction. Here we demonstrate the nitty-gritty details needed to show that the clock inserter really can create any tight packing of gliders that we desire, thus showing that all glider syntheses can be implemented via a p2 slow salvo.
\begin{proposition}\label{prop:clock_inserter}
	Multiple copies of the clock inserter reaction can be used to construct every possible glider salvo.
\end{proposition}


\section{Timing of Tight Glider Salvos}\label{sec:salvo_timing}

Recall the definitions of glider lanes and timing from Section~\ref{sec:glider_lanes}, which give us a way to discuss how close gliders are to each other in both perpendicular directions. We now investigate exactly how tightly gliders in a salvo can be packed. For example, we mentioned in Section~\ref{sec:glider_loops} that two gliders in the same lane must be at least $14$ generations apart from each other or else they will collide. Similarly, it is straightforward to check that gliders that differ by $0, 1, 2, 3, 4, 5,$ or $6$ lanes must have their timings offset by at least $14, 14, 14, 13, 11, 9,$ or $7$ generations, respectively, as demonstrated in Figure~\ref{fig:tight_glider_packings}. On the other hand, gliders that differ by $7$ lanes or more will never collide with each other, regardless of their timings, since the Moore neighbourhoods of those lanes do not overlap enough to cause an unexpected birth between the gliders.

\begin{figure}[!ht]
	\centering\patternimglinkwidth{0.98\textwidth}{tight_glider_packings}
	\caption{The closest timings that are possible between two gliders in nearby lanes without colliding with each other. From left to right, these gliders differ by $0, 1, 2, 3, 4, 5,$ and $6$ lanes, and their timings differ by $14, 14, 14, 13, 11, 9,$ and $7$ generations. The rightmost image shows that gliders that differ by $7$ lanes can never collide with each other as their paths are not close enough to each other.}\label{fig:tight_glider_packings}
\end{figure}


\section{Timing of the Clock Inserter}\label{sec:clock_inserter_timing}

The basic idea behind proving Proposition~\ref{prop:clock_inserter} is to show that we can use the clock inserter to place gliders next to each other in each of the tight configurations from Figure~\ref{fig:tight_glider_packings}. However, this alone is not enough to prove the theorem, since a glider salvo might have dozens of tightly-packed gliders, and a priori it's not obvious that being able to place any pair of gliders means that we can place any complicated configuration of multiple gliders---it could be that no matter which order we place the gliders pairs in, we eventually get blocked off from placing one of the gliders that has other gliders on all sides of it.

To get around this problem, we establish a precise ordering that we will use to construct the salvo. Since the clock inserter is good at placing a glider closely in front of another glider, but bad at placing a glider closely behind another glider, we build the salvo from back-to-front. Specifically, we say that a glider's \emph{rank} is its lane number plus its timing (see Figure~\ref{fig:glider_ranks}), and we construct the salvo in order from the lowest-ranked glider to the highest-ranked glider (breaking ties arbitrarily).\footnote{While the lane and timing of a glider are concepts that are regularly used in the Life community, we have introduced the rank of a glider very specifically for this proof.}

\begin{figure}[!ht]
	\centering
	\gridbox{0.75pt}{\begin{tikzpicture}[scale=0.5, every node/.style={transform shape}]%
		\node[inner sep=0pt,anchor=south west] (glider_loop) at (0.5,0.5) {\patternimgwidth{7cm}{glider_slope_chart_c}};
		
		\letternode{1}{1}{-9}
		\letternode{2}{1}{-6}
		\letternode{3}{1}{-3}
		\letternode{4}{1}{0}
		\letternode{5}{1}{3}
		\letternode{6}{1}{6}
		\letternode{7}{1}{9}
		
		\letternode{1}{2}{$\cdot$}
		\letternode{2}{2}{-7}
		%\letternode{3}{2}{-4}
		%\letternode{4}{2}{-1}
		\letternode{5}{2}{2}
		\letternode{6}{2}{5}
		\letternode{7}{2}{8}
		
		\letternode{1}{3}{$\cdot$}
		%\letternode{2}{3}{-8}
		\letternode{3}{3}{-5}
		%\letternode{4}{3}{-2}
		\letternode{5}{3}{1}
		\letternode{6}{3}{4}
		\letternode{7}{3}{7}
		
		\letternode{1}{4}{$\cdot$}
		\letternode{2}{4}{-9}
		\letternode{3}{4}{-6}
		%\letternode{4}{4}{-3}
		\letternode{5}{4}{0}
		\letternode{6}{4}{3}
		\letternode{7}{4}{6}
		
		\letternode{1}{5}{$\cdot$}
		\letternode{2}{5}{$\cdot$}
		\letternode{3}{5}{-7}
		\letternode{4}{5}{-4}
		\letternode{5}{5}{-1}
		\letternode{6}{5}{2}
		\letternode{7}{5}{5}
		
		\letternode{1}{6}{$\cdot$}
		\letternode{2}{6}{$\cdot$}
		\letternode{3}{6}{-8}
		\letternode{4}{6}{-5}
		\letternode{5}{6}{-2}
		\letternode{6}{6}{1}
		\letternode{7}{6}{4}
		
		\letternode{1}{7}{$\cdot$}
		\letternode{2}{7}{$\cdot$}
		\letternode{3}{7}{-9}
		%\letternode{4}{7}{-6}
		%\letternode{5}{7}{-3}
		%\letternode{6}{7}{0}
		\letternode{7}{7}{3}
		
		\letternode{1}{8}{$\cdot$}
		\letternode{2}{8}{$\cdot$}
		\letternode{3}{8}{$\cdot$}
		\letternode{4}{8}{-7}
		\letternode{5}{8}{-4}
		%\letternode{6}{8}{-1}
		\letternode{7}{8}{2}
		
		\letternode{1}{9}{$\cdot$}
		\letternode{2}{9}{$\cdot$}
		\letternode{3}{9}{$\cdot$}
		\letternode{4}{9}{-8}
		%\letternode{5}{9}{-5}
		\letternode{6}{9}{-2}
		\letternode{7}{9}{1}
		
		\letternode{1}{10}{$\cdot$}
		\letternode{2}{10}{$\cdot$}
		\letternode{3}{10}{$\cdot$}
		\letternode{4}{10}{-9}
		\letternode{5}{10}{-6}
		\letternode{6}{10}{-3}
		\letternode{7}{10}{0}
		
		\end{tikzpicture}}
	\caption{Two gliders that both have a rank of~$0$. The numbers displayed on the grid show the rank of a glider when its leading cell (in the phase of the glider at the top) is at that location. The glider at the bottom has rank $0$ since it will be in that phase in $2$ generations, and its leading cell in that phase will be at a location labelled ``$2$''. Rank increases by $3$ every cell to the right and by $1$ every cell down, so gliders with constant rank lie on lines of slope $3$ in the Life plane.}\label{fig:glider_ranks}
\end{figure}

We need to show that if we insert gliders into the salvo according to their rank, then the (already-placed) low-rank gliders do not collide with the clock inserter reaction as we place the high-rank gliders. To this end, suppose that the glider we are inserting via the clock inserter is in lane $0$ and has timing $0$ (and thus rank~$0$). We will prove the result by contradiction, so let's assume that there is a glider in the salvo that has already been placed that collides with the clock inserter reaction. We derive the contradiction by splitting into two cases, based on the lane of the glider that collides with the clock inserter. Note that all lane and timing (and thus hence rank) numbers that we describe for this interfering glider are relative to the rank $0$ glider that we are inserting. \\

\noindent \textbf{Case 1:} The colliding glider is in one of the lanes $-6, -5, \ldots, 5, 6$.

If the timing of the glider in a particular lane is small enough (i.e., far enough below $0$), it will be far to the top-left of the clock inserter reaction and thus not collide with it. It is straightforward (albeit somewhat tedious) to calculate the smallest possible timing of a glider in each lane $-6, -5, \ldots, 5, 6$ that \emph{does} collide with the clock inserter, and these values are presented in Table~\ref{tab:clock_inserter_ranks}.

\begin{table}[!htb]\vspace*{0.05in}
	\begin{center}		
		\begin{tabular}{r c c c c c c c}
			\toprule
			Lane: & $0$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ \\
			\rowcolor{gray!20} Min. timing: & $-13$ & $-13$ & $-13$ & $-12$ & $-10$ & $-8$ & $-6$ \\\bottomrule
		\end{tabular}
		\caption{The minimal timing that a glider in lanes $0$ through $6$ can have if it collides with the clock inserter reaction. The minimal timing for a glider in lane $-n$ in all of these cases is the same as the timing for a glider in lane $n$.}\label{tab:clock_inserter_ranks}
	\end{center}
\end{table}

Since any pair of gliders with timing differences as in Table~\ref{tab:clock_inserter_ranks} would also collide with each other (refer back to the timings listed in Figure~\ref{fig:tight_glider_packings}), we conclude that if a glider in one of these lanes collides with the clock inserter, then it would also collide with the output glider and thus those two gliders could not be part of the same salvo in the first place. \\

\noindent \textbf{Case 2:} The colliding glider is in one of the lanes $\ldots, -9, -8, -7$ or $7, 8, 9, \ldots$.

In a similar vein to that of case~1, we can calculate the minimum possible timing (and thus minimum rank) of a glider that collides with the clock inserter in each of these lanes, and these values are presented in Table~\ref{tab:clock_inserter_ranks_b}. In this case, however, we are interested in the rank of the colliding glider rather than its timing, and we notice that in each case, regardless of the glider's lane, its rank is strictly positive, which contradicts the fact that we are inserting gliders in order of increasing rank, and we are currently inserting a glider with rank $0$.

\begin{table}[!htb]\vspace*{0.05in}
	\begin{center}		
		\begin{tabular}{r c c c c c c | c c c c c c}
			\toprule
			Lane: & $-n$ & $-11$ & $-10$ & $-9$ & $-8$ & $-7$ & $7$ & $8$ & $9$ & $10$ & $11$ & $n$ \\
			Min. timing: & $2n-5$ & $17$ & $15$ & $13$ & $11$ & $9$ & $-3$ & $15$ & $17$ & $19$ & $21$ & $2n-1$ \\
			\rowcolor{gray!20} Min. rank: & $n-5$ & $6$ & $5$ & $4$ & $3$ & $2$ & $4$ & $23$ & $26$ & $29$ & $32$ & $3n-1$ \\\bottomrule
		\end{tabular}
		\caption{The smallest possible timing and rank that a glider in lanes $\ldots, -9, -8, -7$ or $7, 8, 9, \ldots$ can have if they collide with the clock inserter reaction. Importantly, the rank of the colliding glider is positive in all cases.}\label{tab:clock_inserter_ranks_b}
	\end{center}
\end{table}

While this contradiction completes the proof of Proposition~\ref{prop:clock_inserter}, it is worth focusing on some of the values in Table~\ref{tab:clock_inserter_ranks_b} and clarifying some points about the rank of a glider. Firstly, the obvious pattern of the minimal timing increasing by $2$ generations every time you move farther out by $1$ lane does indeed continue forever---the collision that happens in these lanes occurs with one of the input gliders to the clock inserter rather than with the clock itself, which explains the regular pattern. Secondly, lane~7 is somewhat of an anomaly in Table~\ref{tab:clock_inserter_ranks_b}, with the minimal timing of the glider in that lane being much lower than in the other lanes. The reason for this oddity is that the clock in the clock inserter sticks one lane farther to the right the output glider does, which causes early collisions in this lane, and this lane only. This minimum-timing lane-7 glider collision is displayed in Figure~\ref{fig:clock_inserter_7_lanes}.

\begin{figure}[!ht]
	\centering
	\begin{subfigure}{.48\textwidth}
		\centering\embedlink{clock_inserter_7_lanes_ok}{\vcenteredhbox{\patternimg{0.1}{clock_inserter_7_lanes_ok}} \vcenteredhbox{\genarrow{12}} \vcenteredhbox{\patternimg{0.1}{clock_inserter_7_lanes_ok_12}}}
		\caption{Lane $7$, timing $-4$.}\label{fig:clock_inserter_7_lanes_ok}
	\end{subfigure} \ \ \ \ % 
	\begin{subfigure}{.48\textwidth}
		\centering\embedlink{clock_inserter_7_lanes_bad}{\vcenteredhbox{\patternimg{0.1}{clock_inserter_7_lanes_bad}} \vcenteredhbox{\genarrow{6}} \vcenteredhbox{\patternimg{0.1}{clock_inserter_7_lanes_bad_6}} \vcenteredhbox{\genarrow{1}} \vcenteredhbox{\patternimg{0.1}{clock_inserter_7_lanes_bad_7}}}
		\caption{Lane $7$, timing $-3$.}\label{fig:clock_inserter_7_lanes_bad}
	\end{subfigure}
	\caption{A clock inserter attempting to insert a glider in lane $0$ at timing $0$ when there is already a glider in lane 7 with (a)~timing $-4$ and (b)~timing $-3$. In (a), the new glider is successfully inserted, but in (b), a cell that is outside of the path of the glider that is being inserted (shown in \bgbox{greenback}{green} in generation 6) interferes with the glider from lane~7, causing an extra cell to be born (shown in \bgbox{orangeback}{orange} in generation 7).}\label{fig:clock_inserter_7_lanes}
\end{figure}

In fact, this oddity in lane~7 is exactly why we insert gliders according to their rank rather than (for example) their timing. If we inserted gliders in order from low timing to high timing (i.e., according to diagonal lines of slope $1$ in the Life plane) then we can run into problems when trying to insert gliders that are $7$ lanes apart from each other. However, our choice of defining a glider's rank to equal its lane number plus its timing is by no means the only way of ranking gliders that works. Many other choices are possible, and each ranking function corresponds to lines of different slopes in the Life plane (see Exercise~\ref{exer:slow_salvo_clock_slope}).